<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lp.sqlMapper.order.OrderRent">
  <select id="getMySellRentInfo" parameterType="java.lang.Integer" resultType="com.lp.uav_weixin_back_project.uav_order.model.vo.MySellInfoVo">
    SELECT
      a.id AS productId,
      b.id AS orderId,
      a.rent_product_name AS productName,
      a.rent_product_price AS price,
      a.rent_product_picture AS picture,
      a.rent_product_describe AS productDescribe,
      b.active AS active
      FROM rent_product a
      LEFT JOIN order_rent b ON a.id = b.rent_product_id
      WHERE b.sell_id = #{userId} AND a.flag=1
  </select>

  <delete id="deleteRentOrder" parameterType="java.lang.Integer">
    DELETE FROM order_rent WHERE id=#{orderId}
  </delete>

  <insert id="insertRentOrder" parameterType="java.util.Map" useGeneratedKeys="true" keyProperty="orderId">
    insert into order_rent
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="sellId != null">
        sell_id,
      </if>
      <if test="buyId != null">
        buy_id,
      </if>
      <if test="rentProductId != null">
        rent_product_id,
      </if>
      <if test="addressId != null">
        address_id,
      </if>
      <if test="rentDay != null">
        rent_day,
      </if>
      <if test="orderNum != null">
        order_num,
      </if>
      <if test="price != null">
        price,
      </if>
        <if test="createTime != null">
            create_time,
        </if>
        <if test="lastUpdateTime != null">
            last_update_time,
        </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="sellId != null">
        #{sellId},
      </if>
      <if test="buyId != null">
        #{buyId},
      </if>
      <if test="rentProductId != null">
        #{rentProductId},
      </if>
      <if test="addressId != null">
        #{addressId},
      </if>
      <if test="rentDay != null">
        #{rentDay},
      </if>
      <if test="orderNum != null">
        #{orderNum},
      </if>
      <if test="price != null">
        #{price},
      </if>
        <if test="createTime != null">
            #{createTime},
        </if>
        <if test="lastUpdateTime != null">
            #{lastUpdateTime},
        </if>
    </trim>
  </insert>

  <select id="getMyBuyRentInfo" parameterType="java.lang.Integer" resultType="com.lp.uav_weixin_back_project.uav_order.model.vo.MySellInfoVo">
    SELECT
      a.id AS productId,
      b.id AS orderId,
      a.rent_product_name AS productName,
      a.rent_product_price AS price,
      a.rent_product_picture AS picture,
      a.rent_product_describe AS productDescribe,
      b.active AS active
      FROM rent_product a
      LEFT JOIN order_rent b ON a.id = b.rent_product_id
      WHERE b.buy_id = #{userId} AND a.flag=1
  </select>

  <select id="getRentOrderInfo" parameterType="java.lang.Integer" resultType="com.lp.uav_weixin_back_project.uav_order.model.vo.OrderInfoVo">
    SELECT
      a.id AS productId,
      b.id AS orderId,
      b.price AS price,
      a.rent_product_name AS productName,
      c.alias AS buyAlias,
      b.order_num AS orderNum,
      b.create_time AS buyTime,
      a.rent_product_picture AS picture,
      b.active AS active,
      d.receive_name AS receiveName,
      d.telephone AS telephone,
      d.province AS province,
      d.city AS city,
      d.county AS county,
      d.district_detail AS district_detail,
      b.post_company AS postCompany,
      b.post_num AS postNum,
      b.refund_res AS refundRes
      FROM rent_product a
      LEFT JOIN order_rent b ON a.id = b.rent_product_id
      LEFT JOIN user c ON b.buy_id = c.id
      LEFT JOIN address d ON b.address_id=d.id
      WHERE b.id = #{orderId}
  </select>

  <update id="updateProductFlag" parameterType="java.lang.Integer">
    update rent_product
    SET flag=0
    where id=#{productId}
  </update>

  <update id="toPayRent" parameterType="java.util.Map">
    update order_rent
    SET active=1
    where id=#{orderId}
  </update>

  <update id="toRefundRentOrder" parameterType="com.lp.uav_weixin_back_project.uav_order.model.dto.ToRefundDto">
    update order_rent
    <set>
    active=5,
    <if test="refundRes != null">
      refund_res=#{refundRes},
    </if>
    </set>
    where id=#{orderId}
  </update>

  <update id="toRentDelicery" parameterType="com.lp.uav_weixin_back_project.uav_order.model.dto.ToDeliveryDto">
    update order_rent
    <set>
      active=2,
      <if test="postCompany != null">
        post_company=#{postCompany},
      </if>
      <if test="postNum != null">
        post_num=#{postNum},
      </if>
    </set>
    where id=#{orderId}
  </update>

  <update id="toConfirmRentOrder" parameterType="java.util.Map">
    update order_rent
    SET active=3
    where id=#{orderId}
  </update>
</mapper>